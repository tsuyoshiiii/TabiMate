<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-9">

      <article class="card shadow-sm border-0 mb-5">
        <div class="card-body p-4 p-md-5">

          <div class="d-flex align-items-center mb-4">
            <i class="fa-solid fa-circle-user text-secondary fs-2 me-2"></i>
            <div>
              <div class="fw-bold"><%= link_to @post.member.name, member_path(@post.member), class: "text-dark text-decoration-none" %></div>
              <div class="small text-muted"><%= @post.created_at.strftime('%Y/%m/%d %H:%M') %></div>
            </div>
            

            <% if @post.member == current_member %>
              <div class="ms-auto">
                <%= link_to edit_post_path(@post), class: "btn btn-outline-secondary btn-sm rounded-pill px-3 me-1" do %>
                  <i class="fa-solid fa-pen-to-square"></i> 編集
                <% end %>
                <%= link_to post_path(@post), method: :delete, data: { confirm: "本当に削除しますか？" }, class: "btn btn-outline-danger btn-sm rounded-pill px-3" do %>
                  <i class="fa-solid fa-trash-can"></i> 削除
                <% end %>
              </div>
            <% end %>
          </div>

          <h1 class="h2 fw-bold mb-4"><%= @post.title %></h1>
          <div class="post-body text-secondary lh-lg mb-5" style="white-space: pre-wrap;">
            <%= @post.body %>
          </div>
        </div>
      </article>


      <section class="comment-section">
        <h3 class="h5 fw-bold mb-4">
          <i class="fa-regular fa-comments me-2 text-primary"></i>コメント (<%= @post.post_comments.count %>)
        </h3>


        <div class="mb-5">
          <% @post.post_comments.each do |post_comment| %>
            <div class="card border-0 shadow-sm mb-3">
              <div class="card-body p-3">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <div class="d-flex align-items-center">
                    <i class="fa-solid fa-user-circle text-light fs-4 me-2"></i>
                    <span class="small fw-bold"><%= link_to post_comment.member.name, member_path(post_comment.member), class: "text-dark text-decoration-none" %></span>
                    <span class="extra-small text-muted ms-3" style="font-size: 0.75rem;"><%= post_comment.created_at.strftime('%Y/%m/%d') %></span>
                  </div>
                  <% if post_comment.member == current_member %>
                    <%= link_to post_post_comment_path(@post, post_comment), method: :delete, class: "text-danger small text-decoration-none", data: { confirm: "コメントを削除しますか？" } do %>
                      <i class="fa-solid fa-xmark me-1"></i>削除
                    <% end %>
                  <% end %>
                </div>
                <p class="small text-secondary mb-0 ps-4"><%= post_comment.comment %></p>
              </div>
            </div>
          <% end %>
        </div>


        <div class="card border-0 shadow-sm bg-light">
          <div class="card-body p-4">
            <h4 class="h6 fw-bold mb-3">コメントを投稿する</h4>
            <%= form_with(model:[@post, @post_comment], local: true) do |f| %>
              <div class="mb-3">
                <%= f.text_area :comment, rows:'3', placeholder: "温かいコメントを残しましょう...", class: "form-control border-0 shadow-none", style: "resize: none;" %>
              </div>
              <div class="text-end">
                <%= f.submit "コメントを送信", class: "btn btn-primary rounded-pill px-4 fw-bold shadow-sm" %>
              </div>
            <% end %>
          </div>
        </div>
      </section>

      <div class="text-center mt-5">
        <%= link_to posts_path, class: "text-secondary text-decoration-none" do %>
          <i class="fa-solid fa-arrow-left me-1"></i>投稿一覧に戻る
        <% end %>
      </div>

    </div>
  </div>
</div>