<div class="container my-5">
  <div class="row mb-5 align-items-center">
    <div class="col-md-6">
      <h2 class="h3 fw-bold mb-0">
        <i class="fa-solid fa-earth-americas me-2 text-primary"></i>Posts
      </h2>

    </div>
    <div class="col-md-6 mt-3 mt-md-0">
      <%= form_with url: posts_path, method: :get, local: true, class: "d-flex gap-2" do |f| %>
        <div class="input-group">
          <span class="input-group-text bg-white border-end-0">
            <i class="fa-solid fa-magnifying-glass text-secondary"></i>
          </span>
          <%= f.text_field :search, value: params[:search], class: "form-control border-start-0 ps-0", placeholder: "キーワードで検索..." %>
        </div>
        <%= f.submit "検索", class: "btn btn-primary rounded-pill px-4" %>
      <% end %>
    </div>
  </div>


  <% if params[:search].present? %>
    <div class="mb-4 d-flex align-items-center justify-content-between">
      <h3 class="h6 mb-0 text-secondary">
        「<span class="fw-bold text-dark"><%= params[:search] %></span>」の検索結果
      </h3>
      <%= link_to "クリア", posts_path, class: "text-decoration-none small" %>
    </div>
  <% end %>


  <div class="row">
    <% if @posts.present? %>
      <% @posts.each do |post| %>
        <div class="col-md-6 col-lg-4 mb-4">
          <div class="card h-100 shadow-sm border-0 hover-card transition">
            <div class="card-body p-4 d-flex flex-column">
              <div class="d-flex align-items-center mb-3">

                <i class="fa-solid fa-circle-user text-light fs-3 me-2"></i>
                <span class="small fw-bold text-secondary"><%= post.member.name %></span>
                <span class="ms-auto small text-muted"><%= post.created_at.strftime('%Y/%m/%d') %></span>
              </div>

              <h4 class="h5 fw-bold mb-3">
                <%= link_to post.title, post_path(post), class: "text-dark text-decoration-none" %>
              </h4>
              
              <p class="text-muted small mb-4 flex-grow-1">
                <%= truncate(post.body, length: 80) %>
              </p>

              <div class="d-flex align-items-center justify-content-between border-top pt-3">
                <div class="small text-secondary">
                  <i class="fa-regular fa-comment-dots me-1 text-primary"></i>
                  コメント <span class="fw-bold"><%= post.post_comments.count %></span>
                </div>
                <%= link_to post_path(post), class: "btn btn-link btn-sm p-0 text-primary text-decoration-none fw-bold" do %>
                  詳細を見る <i class="fa-solid fa-chevron-right ms-1"></i>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>

      <div class="col-12 text-center py-5">
        <div class="card border-0 shadow-sm p-5 bg-light">
          <i class="fa-solid fa-magnifying-glass-chart fs-1 text-secondary mb-3"></i>
          <p class="text-muted mb-0">該当する投稿は見つかりませんでした。</p>
          <%= link_to "全ての投稿を表示", posts_path, class: "mt-3 d-inline-block text-primary" %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<style>
  .hover-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 .5rem 1.5rem rgba(0,0,0,.1)!important;
  }
  .transition {
    transition: all 0.3s ease;
  }
</style>